(()=>{"use strict";const e=window.React,t=window.wp.blocks,n=window.wp.blockEditor,a=window.wp.components,l=window.wp.element,o=window.wp.i18n;(0,t.registerBlockType)("custom/read-more-link",{title:(0,o.__)("Read More Link","text-domain"),icon:"admin-links",category:"common",attributes:{postId:{type:"number",default:null},postTitle:{type:"string",default:""},postUrl:{type:"string",default:""}},edit:t=>{const{attributes:r,setAttributes:s}=t,{postId:i,postTitle:c,postUrl:p}=r,[d,m]=(0,l.useState)(""),[u,w]=(0,l.useState)([]),[h,g]=(0,l.useState)(!1),[E,_]=(0,l.useState)(1),[f,k]=(0,l.useState)(1);return(0,l.useEffect)((()=>{""!==d&&(g(!0),(async()=>{try{const e=await wp.apiFetch({path:`/wp/v2/posts?search=${d}&page=${E}&per_page=5`});w(e),k(Math.ceil(e.length)),console.log(Math.ceil(e.length))}catch(e){console.error("Error fetching posts:",e)}finally{g(!1)}})())}),[d,E]),(0,l.useEffect)((()=>{i||(async()=>{g(!0);try{const e=await wp.apiFetch({path:"/wp/v2/posts?per_page=5"});w(e)}catch(e){console.error("Error fetching recent posts:",e)}finally{g(!1)}})()}),[i]),(0,e.createElement)("div",{className:"read-more-block"},(0,e.createElement)(n.InspectorControls,null,(0,e.createElement)(a.PanelBody,{title:(0,o.__)("Post Search","text-domain")},(0,e.createElement)(a.TextControl,{label:(0,o.__)("Search for Post","text-domain"),value:d,onChange:e=>{m(e),_(1)},placeholder:(0,o.__)("Search posts...","text-domain")}),h&&(0,e.createElement)(a.Spinner,null),!h&&0===u.length&&(0,e.createElement)("p",null,(0,o.__)("No posts found.","text-domain")),!h&&u.length>0&&(0,e.createElement)("ul",null,u.map((t=>(0,e.createElement)("li",{key:t.id},(0,e.createElement)(a.Button,{isLink:!0,onClick:()=>(e=>{s({postId:e.id,postTitle:e.title.rendered,postUrl:e.link})})(t)},t.title.rendered))))),(0,e.createElement)("div",{style:{display:"flex",alignItems:"center",gap:"15px"}},E>1&&(0,e.createElement)(a.Button,{isLink:!0,onClick:()=>_(E-1)},(0,o.__)("Previous","text-domain")),E<f&&(0,e.createElement)(a.Button,{isLink:!0,onClick:()=>_(E+1)},(0,o.__)("Next","text-domain"))))),(0,e.createElement)("div",{className:"read-more-preview"},i&&(0,e.createElement)(n.RichText,{tagName:"p",className:"dmg-read-more",value:`Read More: ${c}`,onChange:e=>s({postTitle:e}),allowedFormats:[]})))},save:t=>{const{attributes:n}=t,{postTitle:a,postUrl:l}=n;return a&&l?(0,e.createElement)("p",{className:"dmg-read-more"},(0,e.createElement)("a",{href:l},`Read More: ${a}`)):null}})})();